@model IEnumerable<gad_checa_gestion_cementerio.Data.Boveda>

@{
    ViewData["Title"] = "Bóvedas";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="card-title mb-0">
                        <i class="ti ti-building me-2"></i>Bóvedas
                    </h4>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="form-label">Bloque</label>
                            <select name="bloqueId" class="form-select" asp-items="ViewBag.Bloques">
                                <option value="">Todos los bloques</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tipo</label>
                            <select name="tipo" class="form-select" asp-items="ViewBag.Tipos">
                                <option value="">Todos los tipos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Estado</label>
                            <select name="estado" class="form-select" asp-items="ViewBag.Estados">
                                <option value="">Todos los estados</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-primary d-block w-100">
                                <i class="ti ti-search me-1"></i>Filtrar
                            </button>
                        </div>
                    </form>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Número</th>
                                    <th>Número Secuencial</th>
                                    <th>Bloque</th>
                                    <th>Piso</th>
                                    <th>Estado</th>
                                    <th>Propietario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                        <tr>
                                            <td>@item.Numero</td>
                                            <td>@item.NumeroSecuecial</td>
                                            <td>@item.Piso?.Bloque?.Descripcion</td>
                                            <td>@item.Piso?.NumeroPiso</td>
                                            <td>
                                                @if (item.Estado)
                                                {
                                                        <span class="badge bg-success">Disponible</span>
                                                }
                                                else
                                                {
                                                        <span class="badge bg-danger">Ocupada</span>
                                                }
                                            </td>
                                            <td>
                                                @if (item.Propietario != null)
                                                {
                                                        <div class="d-flex align-items-center">
                                                            <i class="ti ti-user me-2"></i>
                                                            <div>
                                                                <div class="fw-bold">@item.Propietario.Nombres @item.Propietario.Apellidos</div>
                                                                <small class="text-muted">@item.Propietario.TipoIdentificacion: @item.Propietario.NumeroIdentificacion</small>
                                                            </div>
                                                        </div>
                                                }
                                                else
                                                {
                                                        <span class="text-muted">Sin propietario</span>
                                                }
                                            </td>
                                            <td>
                                                <div class="btn-group">
                                                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-primary">
                                                        <i class="ti ti-edit"></i>
                                                    </a>
                                                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">
                                                        <i class="ti ti-eye"></i>
                                                    </a>
                                                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">
                                                        <i class="ti ti-trash"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
            <script>
                $(document).ready(function() {
                    // Mantener los valores seleccionados después de filtrar
                    var urlParams = new URLSearchParams(window.location.search);
                    $('select[name="bloqueId"]').val(urlParams.get('bloqueId'));
                    $('select[name="tipo"]').val(urlParams.get('tipo'));
                    $('select[name="estado"]').val(urlParams.get('estado'));
                });
            </script>
}