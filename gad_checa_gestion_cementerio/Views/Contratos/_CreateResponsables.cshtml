@model IEnumerable<gad_checa_gestion_cementerio.Data.Responsable>

@{
    ViewData["Title"] = "Crear Difunto";
}

<div class="p-4 bg-gray-50 border-gray-200 flex h-auto items-start justify-start rounded-xl border border-dashed dark:bg-neutral-700 dark:border-neutral-600">
    <div class="w-full max-w-2xl">
        <div class="px-5 py-10 relative w-full rounded-3xl sm:p-5">
            <div class="max-w-full text-left">
                <h2 class="text-gray-700 mb-2 text-xl font-semibold">Datos de los responsables del Difunto</h2>
                <p class="mb-6 text-sm text-[#6A717D]">Asegúrate de completar los campos necesarios</p>

                <form method="post" asp-action="CreateResponsables" id="responsablesForm">
                    <div id="responsablesContainer">
                        @for (int i = 0; i < Model.Count(); i++)
                        {
                            <div class="responsable mb-4">
                                <div class="mb-4">
                                    <label asp-for="@Model.ElementAt(i).Nombres" class="block text-sm font-medium text-gray-700"></label>
                                    <input asp-for="@Model.ElementAt(i).Nombres" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
                                    <span asp-validation-for="@Model.ElementAt(i).Nombres" class="text-red-500 text-sm"></span>
                                </div>
                                <div class="mb-4">
                                    <label asp-for="@Model.ElementAt(i).Apellidos" class="block text-sm font-medium text-gray-700"></label>
                                    <input asp-for="@Model.ElementAt(i).Apellidos" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
                                    <span asp-validation-for="@Model.ElementAt(i).Apellidos" class="text-red-500 text-sm"></span>
                                </div>
                                <div class="mb-4">
                                    <label asp-for="@Model.ElementAt(i).Telefono" class="block text-sm font-medium text-gray-700"></label>
                                    <input asp-for="@Model.ElementAt(i).Telefono" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm" />
                                    <span asp-validation-for="@Model.ElementAt(i).Telefono" class="text-red-500 text-sm"></span>
                                </div>
                                <hr class="my-4" />
                            </div>
                        }
                    </div>
                    <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md">Guardar Responsables</button>
                </form>
                <button type="button" class="mt-4 px-4 py-2 bg-green-500 text-white rounded-md" data-toggle="modal" data-target="#addResponsableModal">Agregar Responsable</button>
            </div>
        </div>
    </div>
</div>

<!-- Incluir la vista parcial del modal -->
@await Html.PartialAsync("_AddResponsableModal", new gad_checa_gestion_cementerio.Data.Responsable())
@section Scripts {
    <script>
        document.getElementById('saveResponsableButton').addEventListener('click', function () {
            var container = document.getElementById('responsablesContainer');
            var index = container.getElementsByClassName('responsable').length;

            var nombres = document.querySelector('#addResponsableForm input[name="Nombres"]').value;
            var apellidos = document.querySelector('#addResponsableForm input[name="Apellidos"]').value;
            var telefono = document.querySelector('#addResponsableForm input[name="Telefono"]').value;

            var responsableDiv = document.createElement('div');
            responsableDiv.className = 'responsable mb-4';

            var nombresDiv = document.createElement('div');
            nombresDiv.className = 'mb-4';
            var nombresLabel = document.createElement('label');
            nombresLabel.className = 'block text-sm font-medium text-gray-700';
            nombresLabel.innerText = 'Nombres';
            var nombresInput = document.createElement('input');
            nombresInput.className = 'mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm';
            nombresInput.name = 'responsables[' + index + '].Nombres';
            nombresInput.value = nombres;
            nombresDiv.appendChild(nombresLabel);
            nombresDiv.appendChild(nombresInput);

            var apellidosDiv = document.createElement('div');
            apellidosDiv.className = 'mb-4';
            var apellidosLabel = document.createElement('label');
            apellidosLabel.className = 'block text-sm font-medium text-gray-700';
            apellidosLabel.innerText = 'Apellidos';
            var apellidosInput = document.createElement('input');
            apellidosInput.className = 'mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm';
            apellidosInput.name = 'responsables[' + index + '].Apellidos';
            apellidosInput.value = apellidos;
            apellidosDiv.appendChild(apellidosLabel);
            apellidosDiv.appendChild(apellidosInput);

            var telefonoDiv = document.createElement('div');
            telefonoDiv.className = 'mb-4';
            var telefonoLabel = document.createElement('label');
            telefonoLabel.className = 'block text-sm font-medium text-gray-700';
            telefonoLabel.innerText = 'Teléfono';
            var telefonoInput = document.createElement('input');
            telefonoInput.className = 'mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm';
            telefonoInput.name = 'responsables[' + index + '].Telefono';
            telefonoInput.value = telefono;
            telefonoDiv.appendChild(telefonoLabel);
            telefonoDiv.appendChild(telefonoInput);

            responsableDiv.appendChild(nombresDiv);
            responsableDiv.appendChild(apellidosDiv);
            responsableDiv.appendChild(telefonoDiv);
            responsableDiv.appendChild(document.createElement('hr'));

            container.appendChild(responsableDiv);

            // Limpiar el formulario del modal
            document.getElementById('addResponsableForm').reset();

            // Cerrar el modal
            @* $('#addResponsableModal').modal('hide'); *@
        });
    </script>
}