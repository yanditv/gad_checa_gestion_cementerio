@model gad_checa_gestion_cementerio.Models.Views.FiltroBovedasViewModel

@{
    ViewData["Title"] = "Reporte de Bóvedas";
    Layout = "~/Views/Reportes/_ReportesLayout.cshtml";
}
<div class="card">

    <div class="card-header d-flex flex-wrap justify-content-between align-items-center">
        <div>
            <h4 class="card-title mb-2">@ViewData["Title"]</h4>
            <p class="text-muted">
                Visualice y gestione las bóvedas del cementerio.
            </p>
        </div>
        <div class="d-flex gap-2 align-items-center mt-3 mt-md-0 flex-nowrap">
            <!-- Filtros -->
            <form method="get" asp-action="Bovedas" class="d-flex gap-2 align-items-center flex-nowrap">
                <!-- Tipo de bloque -->
                <select name="tipoBloque" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="">-- Tipo de Bóveda --</option>
                    @foreach (var tipo in Model.TiposDisponibles)
                    {
                        <option value="@tipo" selected="@(Model.TipoBloque == tipo ? "selected" : null)">@tipo</option>
                    }
                </select>

                <!-- Nombre del bloque -->
                <select name="nombreBloque" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="">-- Bloque --</option>
                    @foreach (var bloque in Model.BloquesDisponibles)
                    {
                        <option value="@bloque" selected="@(Model.NombreBloque == bloque ? "selected" : null)">
                            @bloque
                        </option>
                    }
                </select>

                <!-- Botón Filtrar -->
                <button type="submit" class="btn btn-success btn-sm d-flex align-items-center">
                    <i class="ti ti-filter me-1"></i> Filtrar
                </button>
            </form>

            <!-- Botón PDF -->
            <form method="get" asp-action="BovedasPdf">
                <input type="hidden" name="tipoBloque" value="@Model.TipoBloque" />
                <input type="hidden" name="nombreBloque" value="@Model.NombreBloque" />
                <button type="submit" class="btn btn-primary btn-sm ">
                    <i class="ti ti-download"></i> <span class="no-wrap">Generar PDF</span><span class="no-wrap">
                    </span>
                </button>
            </form>
        </div>
    </div>


    <div class="min-h-screen bg-white p-6 flex flex-col items-center">

        <!-- Tabla -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover mb-0">
                <thead class="table-secondary small">
                    <tr>
                        <th scope="col">Bóveda</th>
                        <th scope="col">Piso</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Bloque</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Contrato</th>
                        <th scope="col">Duración</th>
                        <th scope="col">Difunto</th>
                    </tr>
                </thead>
                <tbody class="small">
                    @foreach (var item in Model.Bovedas)
                    {
                        <tr>
                            <td>@item.NumeroBoveda</td>
                            <td>@item.NumeroPiso</td>
                            <td>@item.EstadoBoveda</td>
                            <td>@item.NombreBloque</td>
                            <td>@item.TipoBloque</td>
                            <td>
                                @if (item.NumeroSecuencialContrato != null)
                                {
                                    <div>@item.NumeroSecuencialContrato<br />
                                        <small>@item.FechaInicioContrato?.ToShortDateString() -
                                            @item.FechaFinContrato?.ToShortDateString()</small>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-gray-400 italic">Sin contrato</span>
                                }
                            </td>
                            <td>@item.NumeroDeMeses años</td>
                            <td>
                                @if (item.NombresDifunto != null)
                                {
                                    <div>@item.NombresDifunto
                                        @item.ApellidosDifunto<br /><small>@item.FechaFallecimiento?.ToShortDateString()</small>
                                    </div>
                                }
                                else
                                {
                                    <span class="text-gray-400 italic">Libre</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

</div>
